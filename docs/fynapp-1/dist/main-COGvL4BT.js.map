{"version":3,"file":"main-COGvL4BT.js","sources":["../node_modules/@fynmesh/kernel/lib/use-middleware.js","../src/components.ts","../src/main.ts"],"sourcesContent":["/**\n * mark some user code for middleware usage\n *\n * @param meta Information about the middleware\n * @param config Configuration for the middleware\n * @param user User code that uses the middleware\n * @returns A middleware usage object\n */\nexport const useMiddleware = (meta, user) => {\n    user.__middlewareMeta = [].concat(meta);\n    return user;\n};\nexport const noOpMiddlewareUser = {\n    initialize: () => { },\n    execute: () => { },\n};\n// example usage of useMiddleware\nexport const main = useMiddleware({\n    info: {\n        name: \"react-context\",\n        version: \"^1.0.0\",\n        provider: \"fynapp-react-lib\",\n    },\n    config: { theme: \"light\" },\n}, noOpMiddlewareUser);\n//# sourceMappingURL=use-middleware.js.map","/**\n* This file handles dynamic imports of the reusable components from fynapp-x1\n* These imports are managed by the fynmesh kernel's module federation system\n*/\nimport React from 'react';\n\n// Type definition for the component library\nexport type ComponentLibrary = {\n    Button: React.ComponentType<any>;\n    Card: React.ComponentType<any>;\n    Input: React.ComponentType<any>;\n    Modal: React.ComponentType<any>;\n    Alert: React.ComponentType<any>;\n    Badge: React.ComponentType<any>;\n    Spinner: React.ComponentType<any>;\n};\n\n/**\n * Preloads all components from fynapp-x1 and returns them as a library\n * This should be called before rendering the App component\n */\nexport const preloadComponents = async (): Promise<ComponentLibrary> => {\n    try {\n        // dynamic import exposed modules from module federation remote container\n        // @ts-ignore - TS can't understand module federation remote containers\n        const components = await import('fynapp-x1/main', { with: { type: \"mf-expose\", requireVersion: \"^2.0.0\" } }) as ComponentLibrary;\n\n        // Return the components library\n        return components;\n    } catch (error) {\n        console.error('Failed to load components from fynapp-x1:', error);\n        throw error;\n    }\n};\n\n// Get a specific component by name\nexport const getComponent = async (name: keyof ComponentLibrary) => {\n    const components = await preloadComponents();\n    return components[name];\n};\n\n// Export a lazy loading wrapper for each component\nexport const createLazyComponent = (componentName: keyof ComponentLibrary) => {\n    return React.lazy(() =>\n        preloadComponents()\n            .then(module => ({\n                default: module[componentName]\n            }))\n    );\n};\n","import type { FynModuleRuntime } from \"@fynmesh/kernel\";\nimport { useMiddleware } from \"@fynmesh/kernel\";\nimport React from \"react\";\nimport ReactDomClient from \"react-dom/client\";\n// Used by dynamic component imports\nimport \"./components\";\nimport App from \"./App\";\nimport { preloadComponents, ComponentLibrary } from \"./components\";\n\n/**\n * Standardized middleware user interface\n */\nconst middlewareUser = {\n  /**\n   * Tell middleware what we need - called first to determine readiness\n   */\n  initialize(runtime: FynModuleRuntime) {\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const config = basicCounterData?.config;\n\n    console.debug(\n      `üìã ${runtime.fynApp.name} initialize called with config:`,\n      config\n    );\n\n    // We're a primary provider\n    return {\n      status: \"ready\",\n      mode: \"provider\",\n    };\n  },\n\n  /**\n   * Main function - called when middleware is ready\n   */\n  async execute(runtime: FynModuleRuntime) {\n    // Create a loading indicator\n    const createLoadingIndicator = () => {\n      const loadingDiv = document.createElement(\"div\");\n      loadingDiv.id = \"fynapp-1-loading\";\n      loadingDiv.style.padding = \"20px\";\n      loadingDiv.style.textAlign = \"center\";\n      loadingDiv.innerHTML = `\n            <h2>Loading components from fynapp-x1...</h2>\n            <div style=\"margin-top: 20px; display: inline-block;\">\n                <div style=\"width: 50px; height: 50px; border: 5px solid #f3f3f3;\n                            border-top: 5px solid #3498db; border-radius: 50%;\n                            animation: spin 1s linear infinite;\"></div>\n            </div>\n            <style>\n                @keyframes spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n            </style>\n        `;\n      return loadingDiv;\n    };\n\n    // Find or create the div element to render into\n    let targetDiv = document.getElementById(\"fynapp-1\");\n    if (!targetDiv) {\n      targetDiv = document.createElement(\"div\");\n      targetDiv.id = \"fynapp-1\";\n      document.body.appendChild(targetDiv);\n    }\n\n    // Show loading indicator\n    const loadingIndicator = createLoadingIndicator();\n    targetDiv.appendChild(loadingIndicator);\n\n    // Pre-load components from fynapp-x1\n    let componentLibrary: ComponentLibrary;\n\n    try {\n      // Load the actual components\n      componentLibrary = await preloadComponents();\n      console.debug(\"Successfully loaded component library from fynapp-x1\");\n    } catch (error) {\n      console.error(\"Failed to load components from fynapp-x1:\", error);\n\n      // Show error message\n      targetDiv.innerHTML = `\n            <div style=\"padding: 20px; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;\">\n                <h3>Error Loading Components</h3>\n                <p>Failed to load component library from fynapp-x1. Check console for details.</p>\n                <button onclick=\"location.reload()\">Retry</button>\n            </div>\n        `;\n      return; // Exit early\n    } finally {\n      // Remove loading indicator\n      if (loadingIndicator.parentNode) {\n        loadingIndicator.parentNode.removeChild(loadingIndicator);\n      }\n    }\n\n    // Get the basic counter middleware data to access config\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const middlewareConfig = basicCounterData?.config || { count: 0 };\n\n    console.debug(\n      \"üîç fynapp-1: Available middleware APIs:\",\n      Array.from(runtime.middlewareContext.keys())\n    );\n    console.debug(\"üîç fynapp-1: Middleware config:\", middlewareConfig);\n\n    // Render the React component with pre-loaded components and middleware config\n    const root = ReactDomClient.createRoot(targetDiv);\n\n    root.render(\n      React.createElement(App, {\n        appName: runtime.fynApp.name,\n        components: componentLibrary,\n        middlewareConfig,\n        runtime, // Pass runtime for middleware context access\n      })\n    );\n  },\n};\n\n// Export the middleware usage with standardized interface\nexport const main = useMiddleware(\n  [\n    {\n      info: {\n        name: \"basic-counter\",\n        provider: \"fynapp-react-middleware\",\n        version: \"^1.0.0\",\n      },\n      config: {\n        count: 10,\n      },\n    },\n    {\n      info: {\n        name: \"design-tokens\",\n        provider: \"fynapp-design-tokens\",\n        version: \"^1.0.0\",\n      },\n      config: {\n        theme: \"fynmesh-default\",\n        cssCustomProperties: true,\n        cssVariablePrefix: \"fynmesh\",\n        enableThemeSwitching: true,\n        global: false, // Use scoped themes per fynapp\n      },\n    },\n  ],\n  middlewareUser\n);\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}