{"version":3,"file":"main-_jps_KNR.js","sources":["../node_modules/@fynmesh/kernel/lib/use-middleware.js","../../src/main.ts","../../src/components.ts"],"sourcesContent":["/**\n * mark some user code for middleware usage\n *\n * @param meta Information about the middleware\n * @param config Configuration for the middleware\n * @param user User code that uses the middleware\n * @returns A middleware usage object\n */\nexport const useMiddleware = (meta, user) => {\n    user.__middlewareMeta = [].concat(meta);\n    return user;\n};\nexport const noOpMiddlewareUser = {\n    initialize: () => { },\n    execute: () => { },\n};\n// example usage of useMiddleware\nexport const main = useMiddleware({\n    info: {\n        name: \"react-context\",\n        version: \"^1.0.0\",\n        provider: \"fynapp-react-lib\",\n    },\n    config: { theme: \"light\" },\n}, noOpMiddlewareUser);\n//# sourceMappingURL=use-middleware.js.map","import { useMiddleware, FynModuleRuntime } from \"@fynmesh/kernel\";\nimport React from \"react\";\nimport ReactDomClient from \"react-dom/client\";\n// Used by dynamic component imports\nimport \"./components\";\nimport App from \"./App\";\nimport { preloadComponents, ComponentLibrary } from \"./components\";\n\n/**\n * Standardized middleware user interface\n */\nconst middlewareUser = {\n  /**\n   * Tell middleware what we need - called first to determine readiness\n   */\n  initialize(runtime: FynModuleRuntime) {\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const config = basicCounterData?.config;\n\n    console.debug(\n      `üìã ${runtime.fynApp.name} initialize called with config:`,\n      config\n    );\n\n    // We're a consumer\n    return {\n      status: \"ready\",\n      mode: \"consumer\",\n    };\n  },\n\n  /**\n   * Main function - called when middleware is ready\n   */\n  async execute(runtime: FynModuleRuntime) {\n    console.debug(\"MiddlewareUser.main called\", {\n      fynApp: runtime.fynApp.name,\n    });\n    console.debug(\n      `Bootstrapping ${runtime.fynApp.name} with React ${React.version}`\n    );\n\n    // Find or create the div element to render into\n    let targetDiv = document.getElementById(\"fynapp-1-b\");\n    if (!targetDiv) {\n      targetDiv = document.createElement(\"div\");\n      targetDiv.id = \"fynapp-1-b\";\n      document.body.appendChild(targetDiv);\n    }\n\n    // Load components from fynapp-x1\n    let componentLibrary: ComponentLibrary;\n    try {\n      componentLibrary = await preloadComponents();\n      console.debug(\"Successfully loaded component library from fynapp-x1\");\n    } catch (error) {\n      console.error(\"Failed to load components from fynapp-x1:\", error);\n      targetDiv.innerHTML = `\n        <div style=\"padding: 20px; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;\">\n          <h3>Error Loading Components</h3>\n          <p>Failed to load component library from fynapp-x1. Check console for details.</p>\n          <button onclick=\"location.reload()\">Retry</button>\n        </div>\n      `;\n      return;\n    }\n\n    // Get the basic counter middleware data to access config\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const middlewareConfig = basicCounterData?.config || { count: 0 };\n\n    console.debug(\n      \"üîç fynapp-1-b: Available middleware APIs:\",\n      Array.from(runtime.middlewareContext.keys())\n    );\n    console.debug(\"üîç fynapp-1-b: Middleware config:\", middlewareConfig);\n\n    // Render the React component with middleware config\n    const root = ReactDomClient.createRoot(targetDiv);\n    root.render(\n      React.createElement(App, {\n        appName: runtime.fynApp.name,\n        components: componentLibrary,\n        middlewareConfig,\n        runtime, // Pass runtime for middleware context access\n      })\n    );\n\n    console.debug(`${runtime.fynApp.name} bootstrapped successfully`);\n  },\n};\n\n// Export the middleware usage with standardized interface\n// This app is a consumer - it consumes the basic counter config from the provider\nexport const main = useMiddleware(\n  [\n    {\n      info: {\n        name: \"basic-counter\",\n        provider: \"fynapp-react-middleware\",\n        version: \"^1.0.0\",\n      },\n      config: \"consume-only\", // Consumer - uses config from provider\n    },\n    {\n      info: {\n        name: \"design-tokens\",\n        provider: \"fynapp-design-tokens\",\n        version: \"^1.0.0\",\n      },\n      config: {\n        theme: \"fynmesh-green\", // Start with a different theme\n        cssCustomProperties: true,\n        cssVariablePrefix: \"fynmesh\",\n        enableThemeSwitching: true,\n        global: false, // Use scoped themes per fynapp\n      },\n    },\n  ],\n  middlewareUser\n);\n","/**\n* This file handles dynamic imports of the reusable components from fynapp-x1\n* These imports are managed by the fynmesh kernel's module federation system\n*/\nimport React from 'react';\n\n// Type definition for the component library\nexport type ComponentLibrary = {\n    Button: React.ComponentType<any>;\n    Card: React.ComponentType<any>;\n    Input: React.ComponentType<any>;\n    Modal: React.ComponentType<any>;\n    Alert: React.ComponentType<any>;\n    Badge: React.ComponentType<any>;\n    Spinner: React.ComponentType<any>;\n};\n\n/**\n * Preloads all components from fynapp-x1 and returns them as a library\n * This should be called before rendering the App component\n */\nexport const preloadComponents = async (): Promise<ComponentLibrary> => {\n    try {\n        // dynamic import exposed modules from module federation remote container\n        // @ts-ignore - TS can't understand module federation remote containers\n        const components = await import('fynapp-x1/main', { with: { type: \"mf-expose\", requireVersion: \"^2.0.0\" } }) as ComponentLibrary;\n\n        // Return the components library\n        return components;\n    } catch (error) {\n        console.error('Failed to load components from fynapp-x1:', error);\n        throw error;\n    }\n};\n\n// Get a specific component by name\nexport const getComponent = async (name: keyof ComponentLibrary) => {\n    const components = await preloadComponents();\n    return components[name];\n};\n\n// Export a lazy loading wrapper for each component\nexport const createLazyComponent = (componentName: keyof ComponentLibrary) => {\n    return React.lazy(() =>\n        preloadComponents()\n            .then(module => ({\n                default: module[componentName]\n            }))\n    );\n};\n"],"names":["useMiddleware","meta","user","__middlewareMeta","concat","info","name","version","provider","config","theme","initialize","execute","exports","cssCustomProperties","cssVariablePrefix","enableThemeSwitching","global","runtime","basicCounterData","middlewareContext","get","console","debug","fynApp","status","mode","React","componentLibrary","targetDiv","document","getElementById","createElement","id","body","appendChild","async","Federation","_importExpose","error","preloadComponents","innerHTML","middlewareConfig","count","Array","from","keys","ReactDomClient","createRoot","render","App","appName","components"],"mappings":"oVAQO,MAAMA,EAAgB,CAACC,EAAMC,KAChCA,EAAKC,iBAAmB,GAAGC,OAAOH,GAC3BC,GAOSF,EAAc,CAC9BK,KAAM,CACFC,KAAM,gBACNC,QAAS,SACTC,SAAU,oBAEdC,OAAQ,CAAEC,MAAO,UAXa,CAC9BC,WAAY,OACZC,QAAS,SCgFOC,EAAA,OAAAb,EAClB,CACE,CACEK,KAAM,CACJC,KAAM,gBACNE,SAAU,0BACVD,QAAS,UAEXE,OAAQ,gBAEV,CACEJ,KAAM,CACJC,KAAM,gBACNE,SAAU,uBACVD,QAAS,UAEXE,OAAQ,CACNC,MAAO,gBACPI,qBAAqB,EACrBC,kBAAmB,UACnBC,sBAAsB,EACtBC,QAAQ,KAxGO,CAIrB,UAAAN,CAAWO,GACT,MAAMC,EAAmBD,EAAQE,kBAAkBC,IAAI,iBACjDZ,EAASU,GAAkBV,OAQjC,OANAa,QAAQC,MACN,MAAML,EAAQM,OAAOlB,sCACrBG,GAIK,CACLgB,OAAQ,QACRC,KAAM,WAET,EAKD,aAAMd,CAAQM,GACZI,QAAQC,MAAM,6BAA8B,CAC1CC,OAAQN,EAAQM,OAAOlB,OAEzBgB,QAAQC,MACN,iBAAiBL,EAAQM,OAAOlB,mBAAmBqB,EAAMpB,WAI3D,IAQIqB,EARAC,EAAYC,SAASC,eAAe,cACnCF,IACHA,EAAYC,SAASE,cAAc,OACnCH,EAAUI,GAAK,aACfH,SAASI,KAAKC,YAAYN,IAK5B,IACED,OChC2BQ,WAC7B,IAMI,aAHyBC,EAAAC,cAAO,oCAIlC,MAAOC,GAEL,MADAjB,QAAQiB,MAAM,4CAA6CA,GACrDA,IDsBiBC,GACzBlB,QAAQC,MAAM,wDACd,MAAOgB,GASP,OARAjB,QAAQiB,MAAM,4CAA6CA,QAC3DV,EAAUY,UAAY,qWAWxB,MAAMtB,EAAmBD,EAAQE,kBAAkBC,IAAI,iBACjDqB,EAAmBvB,GAAkBV,QAAU,CAAEkC,MAAO,GAE9DrB,QAAQC,MACN,4CACAqB,MAAMC,KAAK3B,EAAQE,kBAAkB0B,SAEvCxB,QAAQC,MAAM,oCAAqCmB,GAGtCK,EAAeC,WAAWnB,GAClCoB,OACHtB,EAAMK,cAAckB,EAAK,CACvBC,QAASjC,EAAQM,OAAOlB,KACxB8C,WAAYxB,EACZc,mBACAxB,aAIJI,QAAQC,MAAM,GAAGL,EAAQM,OAAOlB,iCACjC","x_google_ignoreList":[0]}