{"version":3,"file":"main-BwHgsi-2.js","sources":["../node_modules/@fynmesh/kernel/lib/use-middleware.js","../../src/main.ts"],"sourcesContent":["/**\n * mark some user code for middleware usage\n *\n * @param meta Information about the middleware\n * @param config Configuration for the middleware\n * @param user User code that uses the middleware\n * @returns A middleware usage object\n */\nexport const useMiddleware = (meta, user) => {\n    user.__middlewareMeta = [].concat(meta);\n    return user;\n};\nexport const noOpMiddlewareUser = {\n    initialize: () => ({ status: \"ready\" }),\n    execute: () => { },\n};\n// example usage of useMiddleware\nexport const main = useMiddleware({\n    info: {\n        name: \"react-context\",\n        version: \"^1.0.0\",\n        provider: \"fynapp-react-lib\",\n    },\n    config: { theme: \"light\" },\n}, noOpMiddlewareUser);\n//# sourceMappingURL=use-middleware.js.map","import { useMiddleware, FynModuleRuntime, ComponentFactoryResult, SelfManagedResult, NoRenderResult, ComponentProps } from \"@fynmesh/kernel\";\n// Used by dynamic component imports\nimport \"./components\";\n\n/**\n * Standardized middleware user interface\n */\nconst middlewareUser = {\n  /**\n   * Tell middleware what we need - called first to determine readiness\n   */\n  initialize(runtime: FynModuleRuntime) {\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const config = basicCounterData?.config;\n\n    console.debug(\n      `📋 ${runtime.fynApp.name} initialize called with config:`,\n      config\n    );\n\n    // We're a consumer\n    return {\n      status: \"ready\",\n      mode: \"consumer\",\n    };\n  },\n\n  /**\n   * Main function - called when middleware is ready\n   */\n  async execute(runtime: FynModuleRuntime): Promise<ComponentFactoryResult | SelfManagedResult | NoRenderResult | void> {\n    console.debug(\"🚀 FynApp 1-B initializing with middleware support\");\n\n    // Check if shell middleware is managing this execution\n    const shellMiddleware = runtime.middlewareContext.get(\"shell-layout\");\n    const isShellManaged = shellMiddleware?.isShellManaged;\n    \n    console.debug(`🔍 ${runtime.fynApp.name} execute - Shell managed: ${isShellManaged}`);\n\n    // Get the basic counter middleware data to access config\n    const basicCounterData = runtime.middlewareContext.get(\"basic-counter\");\n    const middlewareConfig = basicCounterData?.config || { count: 0 };\n\n    console.debug(\n      \"🔍 fynapp-1-b: Available middleware APIs:\",\n      Array.from(runtime.middlewareContext.keys())\n    );\n    console.debug(\"🔍 fynapp-1-b: Middleware config:\", middlewareConfig);\n\n    // Load components from fynapp-x1\n    let components;\n    try {\n      const { preloadComponents } = await import('./components');\n      components = await preloadComponents();\n      console.debug(\"✅ fynapp-1-b: Loaded components from fynapp-x1\", Object.keys(components));\n    } catch (error) {\n      console.error(\"❌ fynapp-1-b: Failed to load components:\", error);\n      // Return error result\n      const noRenderResult: NoRenderResult = {\n        type: 'no-render',\n        message: `Failed to load components: ${(error as Error).message}`,\n        metadata: {\n          framework: 'react',\n          version: '19',\n          capabilities: []\n        }\n      };\n      return noRenderResult;\n    }\n\n    // Create a unified component that works in both modes\n    const createAppComponent = async (React: any) => {\n      const App = (await import('./App')).default;\n      \n      const AppWrapper = (props: any) => {\n        return React.createElement(\n          React.Suspense,\n          { fallback: React.createElement('div', { style: { padding: '1rem' } }, 'Loading...') },\n          React.createElement(App, {\n            appName: runtime.fynApp.name,\n            components,\n            middlewareConfig,\n            runtime,\n            ...props\n          })\n        );\n      };\n      \n      return AppWrapper;\n    };\n\n    if (isShellManaged) {\n      // Shell middleware will handle execution - return component factory with full App\n      console.debug(`🎭 ${runtime.fynApp.name} returning component factory for shell`);\n      \n      const result: ComponentFactoryResult = {\n        type: 'component-factory',\n        componentFactory: (React: any) => ({\n          component: async ({ fynAppName, runtime: shellRuntime, ...props }: ComponentProps) => {\n            const AppComponent = await createAppComponent(React);\n            return React.createElement(AppComponent, props);\n          },\n        }),\n        metadata: {\n          framework: 'react',\n          version: '19',\n          capabilities: ['component']\n        }\n      };\n      \n      return result;\n    } else {\n      // Standalone mode - render the same App component using our own React\n      console.debug(`🚀 ${runtime.fynApp.name} executing in standalone mode`);\n      \n      const targetElement = document.getElementById('fynapp-1-b');\n      if (targetElement) {\n        try {\n          // Dynamic import to avoid build issues\n          const React = (await import('react')).default;\n          const ReactDOM = (await import('react-dom/client')).default;\n          \n          // Use the same unified component\n          const AppComponent = await createAppComponent(React);\n          \n          const root = ReactDOM.createRoot(targetElement);\n          root.render(React.createElement(AppComponent));\n          \n          const result: SelfManagedResult = {\n            type: 'self-managed',\n            target: targetElement,\n            cleanup: () => root.unmount?.(),\n            metadata: {\n              framework: 'react',\n              version: '19',\n              capabilities: ['self-managed']\n            }\n          };\n          \n          return result;\n        } catch (error) {\n          console.error('Failed to render in standalone mode:', error);\n          const noRenderResult: NoRenderResult = {\n            type: 'no-render',\n            message: `Failed to render: ${(error as Error).message}`,\n            metadata: {\n              framework: 'react',\n              version: '19',\n              capabilities: []\n            }\n          };\n          \n          return noRenderResult;\n        }\n      }\n      \n      // No target element found\n      const noRenderResult: NoRenderResult = {\n        type: 'no-render',\n        message: 'Target element #fynapp-1-b not found',\n        metadata: {\n          framework: 'react',\n          version: '19',\n          capabilities: []\n        }\n      };\n      \n      return noRenderResult;\n    }\n  },\n};\n\n// Export the middleware usage with standardized interface\n// This app is a consumer - it consumes the basic counter config from the provider\nexport const main = useMiddleware(\n  [\n    {\n      info: {\n        name: \"basic-counter\",\n        provider: \"fynapp-react-middleware\",\n        version: \"^1.0.0\",\n      },\n      config: \"consume-only\", // Consumer - uses config from provider\n    },\n    {\n      info: {\n        name: \"design-tokens\",\n        provider: \"fynapp-design-tokens\",\n        version: \"^1.0.0\",\n      },\n      config: {\n        theme: \"fynmesh-green\", // Start with a different theme\n        cssCustomProperties: true,\n        cssVariablePrefix: \"fynmesh\",\n        enableThemeSwitching: true,\n        global: false, // Use scoped themes per fynapp\n      },\n    },\n  ],\n  middlewareUser\n);\n"],"names":["useMiddleware","meta","user","__middlewareMeta","concat","info","name","version","provider","config","theme","initialize","status","execute","exports","cssCustomProperties","cssVariablePrefix","enableThemeSwitching","global","runtime","basicCounterData","middlewareContext","get","console","debug","fynApp","mode","shellMiddleware","isShellManaged","middlewareConfig","count","components","Array","from","keys","preloadComponents","module","import","Object","error","type","message","metadata","framework","capabilities","createAppComponent","async","React","App","default","props","createElement","Suspense","fallback","style","padding","appName","componentFactory","component","fynAppName","shellRuntime","AppComponent","targetElement","document","getElementById","ReactDOM","root","createRoot","render","target","cleanup","unmount"],"mappings":"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","x_google_ignoreList":[0]}