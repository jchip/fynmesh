{"version":3,"file":"main-c47p0ikH.js","sources":["../src/main.ts"],"sourcesContent":["import { ReactContextMiddleware } from \"./middleware/react-context\";\nimport { FynAppMiddleware, FynAppMiddlewareCallContext } from \"@fynmesh/kernel\";\n\n// =============================================================================\n// Export for Federation\n// =============================================================================\n\n/**\n * Export middleware instance for federation loading\n * The kernel will look for exports that start with __middleware__\n */\nexport const __middleware__ReactContext = new ReactContextMiddleware();\n\nexport const __middleware__BasicCounter: FynAppMiddleware = {\n  name: \"basic-counter\",\n\n  async setup(cc: FynAppMiddlewareCallContext): Promise<any> {\n    const mwContext = cc.runtime.middlewareContext;\n\n    let status = \"defer\";\n\n    // get config from fynapp's useMiddleware\n    // need the middleware usage object\n\n    const config = cc.meta.config;\n    if (config !== \"consume-only\") {\n      const shareKey = `${cc.reg.fullKey}-${cc.fynApp.name}@${cc.fynApp.version}`;\n      const initialConfig = {\n        count: 0,\n        ...(config as any),\n      };\n\n      const eventTarget = new EventTarget();\n\n      const data = mwContext.get(this.name) || {\n        initialConfig, // Store the original config for reset functionality\n        config: { ...initialConfig }, // Current working config\n        eventTarget, // Standard EventTarget for inter-app communication\n\n        // Methods for apps to use\n        increment(source?: string) {\n          this.config.count++;\n          const event = new CustomEvent(\"counterChanged\", {\n            detail: {\n              count: this.config.count,\n              source: source || \"unknown\",\n            },\n          });\n          this.eventTarget.dispatchEvent(event);\n          return this.config.count;\n        },\n\n        reset(source?: string) {\n          this.config.count = this.initialConfig.count;\n          const event = new CustomEvent(\"counterChanged\", {\n            detail: {\n              count: this.config.count,\n              source: source || \"unknown\",\n            },\n          });\n          this.eventTarget.dispatchEvent(event);\n          return this.config.count;\n        },\n\n        setCount(newCount: number, source?: string) {\n          this.config.count = newCount;\n          const event = new CustomEvent(\"counterChanged\", {\n            detail: {\n              count: this.config.count,\n              source: source || \"unknown\",\n            },\n          });\n          this.eventTarget.dispatchEvent(event);\n          return this.config.count;\n        },\n      };\n\n      mwContext.set(this.name, data);\n      cc.reg.hostFynApp.middlewareContext.set(shareKey, data);\n      status = \"ready\";\n      const event = new CustomEvent(\"MIDDLEWARE_READY\", {\n        detail: { name: this.name, share: { shareKey }, status, cc },\n      });\n      cc.kernel.emitAsync(event);\n      console.debug(\n        `üîç fynapp-react-middleware: Basic counter ready event dispatched now:`,\n        Date.now()\n      );\n    } else {\n      const shareKey = cc.runtime.share?.shareKey;\n      console.debug(\n        \"üîç fynapp-react-middleware: basic counter shareKey:\",\n        shareKey,\n        cc.runtime\n      );\n      const data = cc.reg.hostFynApp.middlewareContext.get(shareKey);\n      if (data) {\n        mwContext.set(this.name, data);\n        status = \"ready\";\n      }\n      console.debug(\n        `üîç fynapp-react-middleware: status: ${status} Basic counter setup for`,\n        cc.fynApp.name,\n        cc.fynApp.version,\n        \"is consume-only now:\",\n        Date.now()\n      );\n    }\n\n    return { status };\n  },\n\n  apply(_cc: FynAppMiddlewareCallContext) {\n    // nothing to apply\n  },\n};\n"],"names":[],"mappings":"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"}